# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ YooKassa –¥–ª—è Hyperswitch

## –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ YooKassa

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç YooKassa: https://yookassa.ru/
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Üí **API-–∫–ª—é—á–∏**
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API-–∫–ª—é—á –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Shop ID** (–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞)
   - **Secret Key** (–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)

## –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—Å –≤–∞—à–µ–≥–æ Mac):
scp /Users/timur/Documents/claude/hyperswitch/setup-yookassa.sh timur@45.156.21.104:/tmp/

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
ssh timur@45.156.21.104
cd /tmp
chmod +x setup-yookassa.sh
./setup-yookassa.sh
```

–°–∫—Ä–∏–ø—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ Shop ID –∏ Secret Key.

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhooks –≤ YooKassa

1. –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooKassa –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
2. –î–æ–±–∞–≤—å—Ç–µ URL –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
   ```
   https://dagstatus.ru/api/webhooks/yookassa
   ```
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:
   - `payment.succeeded` - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
   - `payment.canceled` - –æ—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞
   - `refund.succeeded` - –≤–æ–∑–≤—Ä–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω

## –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã YooKassa:

**–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞:**
```
–ù–æ–º–µ—Ä: 5555 5555 5555 4477
–°—Ä–æ–∫: 12/25
CVC: 123
```

**–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–π –ø–ª–∞—Ç—ë–∂:**
```
–ù–æ–º–µ—Ä: 5555 5555 5555 5599
–°—Ä–æ–∫: 12/25
CVC: 123
```

### –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ API:

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Publishable Key –∏–∑ –≤—ã–≤–æ–¥–∞ —Å–∫—Ä–∏–ø—Ç–∞
curl -X POST "https://dagstatus.ru/api/payments" \
  -H "Content-Type: application/json" \
  -H "api-key: YOUR_PUBLISHABLE_KEY" \
  -d '{
    "amount": 10000,
    "currency": "RUB",
    "confirm": false,
    "capture_method": "automatic",
    "customer_id": "customer_test",
    "email": "test@example.com",
    "description": "–¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂"
  }'
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã:

YooKassa –≤ Hyperswitch –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã (Visa, Mastercard, –ú–ò–†)
- üì± –Ø–Ω–¥–µ–∫—Å.–î–µ–Ω—å–≥–∏ (–ÆMoney)
- üè¶ –°–±–µ—Ä–±–∞–Ω–∫ –û–Ω–ª–∞–π–Ω
- üí∞ QIWI Wallet
- üì≤ –ê–ª—å—Ñ–∞-–ö–ª–∏–∫

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è YooKassa API: https://yookassa.ru/developers/api
- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: https://yookassa.ru/my
- –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞: https://yookassa.ru/developers/using-api/testing

## Troubleshooting

### –û—à–∏–±–∫–∞ "Invalid credentials"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å Shop ID –∏ Secret Key
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –∫–ª—é—á –∞–∫—Ç–∏–≤–µ–Ω –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

### –ü–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –æ—Ç–∫–ª—é—á—ë–Ω –¥–ª—è production
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∞–≥–∞–∑–∏–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ YooKassa
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –º–∞–≥–∞–∑–∏–Ω–∞

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL webhook –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö YooKassa
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ firewall —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs hyperswitch-server | grep webhook`
